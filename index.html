<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Skrining TBC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Animasi sederhana untuk loader */
      .loader {
        border-top-color: #10b981;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen font-sans">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <img
              src="https://pkmtrenggalek.github.io/SIPP/Assets/pkmtglk.jpeg"
              alt="Logo"
              class="h-10 w-auto"
            />
            <h1 class="text-xl font-bold text-gray-900">
              Dashboard Skrining TBC
            </h1>
          </div>
          <p class="text-sm text-gray-500">PKM Trenggalek</p>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Aksi Section -->
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Pilih Aksi</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Card Skrining Anak -->
          <div
            class="bg-blue-50 border border-blue-200 rounded-xl p-6 text-center hover:shadow-lg transition-shadow duration-300"
          >
            <div class="flex justify-center mb-4">
              <svg
                class="h-12 w-12 text-blue-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
                ></path>
              </svg>
            </div>
            <h3 class="text-lg font-semibold text-blue-900 mb-2">
              Skrining TBC Anak
            </h3>
            <p class="text-blue-700 mb-4">
              Isi kuesioner skrining untuk pasien anak.
            </p>
            <a
              href="anak.html"
              class="inline-flex items-center px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors"
            >
              Mulai Skrining
            </a>
          </div>
          <!-- Card Skrining Dewasa -->
          <div
            class="bg-green-50 border border-green-200 rounded-xl p-6 text-center hover:shadow-lg transition-shadow duration-300"
          >
            <div class="flex justify-center mb-4">
              <svg
                class="h-12 w-12 text-green-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                ></path>
              </svg>
            </div>
            <h3 class="text-lg font-semibold text-green-900 mb-2">
              Skrining TBC Dewasa
            </h3>
            <p class="text-green-700 mb-4">
              Isi kuesioner skrining untuk pasien dewasa.
            </p>
            <a
              href="dewasa.html"
              class="inline-flex items-center px-4 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors"
            >
              Mulai Skrining
            </a>
          </div>
        </div>
      </section>

      <!-- RINGKASAN TERDUGA TBC (BARU) -->
      <section class="mb-12">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">
          Ringkasan Kasus Terduga TBC
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div
            class="bg-blue-50 border border-blue-200 rounded-xl p-6 text-center"
          >
            <h3 class="text-lg font-semibold text-blue-800 mb-2">
              Jumlah Kasus Anak
            </h3>
            <p class="text-4xl font-bold text-blue-600" id="countAnak">0</p>
          </div>
          <div
            class="bg-green-50 border border-green-200 rounded-xl p-6 text-center"
          >
            <h3 class="text-lg font-semibold text-green-800 mb-2">
              Jumlah Kasus Dewasa
            </h3>
            <p class="text-4xl font-bold text-green-600" id="countDewasa">0</p>
          </div>
        </div>
      </section>

      <!-- Results Section -->
      <section>
        <h2 class="text-2xl font-bold text-gray-800 mb-6">
          Data Hasil Skrining
        </h2>
        <div class="bg-white rounded-xl shadow-md overflow-hidden">
          <!-- Tab Navigation -->
          <div class="flex border-b">
            <button
              id="tabAnak"
              onclick="switchTabAndFetch('Anak')"
              class="flex-1 px-6 py-3 text-center font-semibold text-blue-600 bg-blue-50 border-b-2 border-blue-600 focus:outline-none transition"
            >
              Data Anak
            </button>
            <button
              id="tabDewasa"
              onclick="switchTabAndFetch('Dewasa')"
              class="flex-1 px-6 py-3 text-center font-semibold text-gray-500 hover:text-gray-700 focus:outline-none transition"
            >
              Data Dewasa
            </button>
          </div>

          <!-- Tab Content -->
          <div class="p-6">
            <!-- Loader -->
            <div id="loader" class="hidden text-center py-8">
              <div
                class="loader border-4 border-gray-200 rounded-full w-8 h-8 mx-auto mb-4"
              ></div>
              <p class="text-gray-500">Memuat data...</p>
            </div>

            <!-- Data Anak Table -->
            <div id="contentAnak">
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Tanggal
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Nama
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Jenis Kelamin
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Posyandu
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Klasifikasi
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Tindak Lanjut
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    id="tableBodyAnak"
                    class="bg-white divide-y divide-gray-200"
                  >
                    <!-- Data akan dimuat di sini oleh JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Data Dewasa Table -->
            <div id="contentDewasa" class="hidden">
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Tanggal
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Nama
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Usia
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Pekerjaan
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Klasifikasi
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Tindak Lanjut
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    id="tableBodyDewasa"
                    class="bg-white divide-y divide-gray-200"
                  >
                    <!-- Data akan dimuat di sini oleh JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // GANTI DENGAN URL WEB APP ANDA
        const GAS_WEB_APP_URL =
          "https://script.google.com/macros/s/AKfycbwlI9BTFcV3rkaVwQXKhxPAKkhp283G1kERqqDM8GgNB7al1Rw6P848mWoQjEG-xSnDVw/exec";

        // Elemen-elemen DOM
        const loader = document.getElementById("loader");
        const contentAnak = document.getElementById("contentAnak");
        const contentDewasa = document.getElementById("contentDewasa");
        const tableBodyAnak = document.getElementById("tableBodyAnak");
        const tableBodyDewasa = document.getElementById("tableBodyDewasa");
        const countAnakEl = document.getElementById("countAnak");
        const countDewasaEl = document.getElementById("countDewasa");

        // Variabel global untuk menyimpan data
        let dataAnak = [];
        let dataDewasa = [];

        // Fungsi untuk berpindah tab dan memuat data (DIPERBAIKI)
        window.switchTabAndFetch = function (type) {
          const tabAnak = document.getElementById("tabAnak");
          const tabDewasa = document.getElementById("tabDewasa");

          if (type === "Anak") {
            tabAnak.className =
              "flex-1 px-6 py-3 text-center font-semibold text-blue-600 bg-blue-50 border-b-2 border-blue-600 focus:outline-none transition";
            tabDewasa.className =
              "flex-1 px-6 py-3 text-center font-semibold text-gray-500 hover:text-gray-700 focus:outline-none transition";
            contentAnak.classList.remove("hidden");
            contentDewasa.classList.add("hidden");
            // Panggil fetch untuk data Anak
            fetchData("TBCDataAnak");
          } else {
            tabDewasa.className =
              "flex-1 px-6 py-3 text-center font-semibold text-green-600 bg-green-50 border-b-2 border-green-600 focus:outline-none transition";
            tabAnak.className =
              "flex-1 px-6 py-3 text-center font-semibold text-gray-500 hover:text-gray-700 focus:outline-none transition";
            contentDewasa.classList.remove("hidden");
            contentAnak.classList.add("hidden");
            // Panggil fetch untuk data Dewasa
            fetchData("TBCDataDewasa");
          }
        };

        // Fungsi untuk memperbarui jumlah kasus (BARU)
        function updateSummaryCounts() {
          const countAnak = dataAnak.filter(
            (row) => row.klasifikasi === "Terduga TBC"
          ).length;
          const countDewasa = dataDewasa.filter(
            (row) => row.klasifikasi === "Terduga TBC"
          ).length;

          countAnakEl.textContent = countAnak;
          countDewasaEl.textContent = countDewasa;
        }

        // Fungsi untuk mengambil data dari Google Sheet
        async function fetchData(sheetName) {
          loader.classList.remove("hidden");
          try {
            const response = await fetch(
              `${GAS_WEB_APP_URL}?sheet=${sheetName}`
            );
            const result = await response.json();

            if (result.status === "success") {
              // Simpan data ke variabel global
              if (sheetName === "TBCDataAnak") {
                dataAnak = result.data;
              } else {
                dataDewasa = result.data;
              }
              renderTable(result.data, sheetName);
              updateSummaryCounts(); // Perbarui ringkasan setelah data dimuat
            } else {
              throw new Error(result.message);
            }
          } catch (error) {
            console.error("Error fetching data:", error);
            const targetTableBody =
              sheetName === "TBCDataAnak" ? tableBodyAnak : tableBodyDewasa;
            targetTableBody.innerHTML = `<tr><td colspan="6" class="px-6 py-4 text-center text-red-500">Gagal memuat data. Periksa konsol.</td></tr>`;
          } finally {
            loader.classList.add("hidden");
          }
        }

        // Fungsi untuk merender data ke dalam tabel
        function renderTable(data, sheetName) {
          const targetTableBody =
            sheetName === "TBCDataAnak" ? tableBodyAnak : tableBodyDewasa;
          targetTableBody.innerHTML = ""; // Kosongkan tabel sebelumnya

          if (data.length === 0) {
            targetTableBody.innerHTML = `<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Belum ada data.</td></tr>`;
            return;
          }

          data.forEach((row) => {
            const tr = document.createElement("tr");
            tr.className = "hover:bg-gray-50";
            if (sheetName === "TBCDataAnak") {
              tr.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                              row.tanggal_skrining || "-"
                            }</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${
                              row.nama || "-"
                            }</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                              row.jenis_kelamin || "-"
                            }</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                              row.posyandu || "-"
                            }</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                              row.klasifikasi || "-"
                            }</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                              row.tindak_lanjut || "-"
                            }</td>
                        `;
            } else {
              tr.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
                              row.tanggal_skrining || "-"
                            }</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${
                              row.nama || "-"
                            }</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                              row.usia ? row.usia + " Tahun" : "-"
                            }</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                              row.pekerjaan || "-"
                            }</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                              row.klasifikasi || "-"
                            }</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
                              row.tindak_lanjut || "-"
                            }</td>
                        `;
            }
            targetTableBody.appendChild(tr);
          });
        }

        // Muat data untuk tab yang aktif saat pertama kali dibuka
        fetchData("TBCDataAnak");
      });
    </script>
  </body>
</html>
